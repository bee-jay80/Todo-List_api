<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Management System - API Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f8f9fa; }
        h1, h2, h3 { color: #2c3e50; }
        code, pre { background: #eef; padding: 2px 6px; border-radius: 4px; }
        .endpoint { background: #fff; border: 1px solid #ddd; padding: 1em; margin-bottom: 1em; border-radius: 6px; }
        .payload, .response { background: #f4f4f4; padding: 1em; border-radius: 6px; margin-bottom: 1em; }
        .method { font-weight: bold; color: #2980b9; }
        .section { margin-bottom: 2em; }
    </style>
</head>
<body>
    <h1>Student Management System - API Documentation</h1>
    <p>
        The Student Management System is a Django REST Framework-based backend for managing students, courses, authentication, and profile images. It features JWT authentication, Cloudinary integration for image hosting, and robust password management.
    </p>

    <div class="section">
        <h2>API Overview</h2>
        <ul>
            <li>Base URL: <code>/api/</code></li>
            <li>Authentication: JWT (Bearer token)</li>
            <li>Image Hosting: Cloudinary</li>
            <li>Database: MySQL or SQLite</li>
        </ul>
    </div>

    <div class="section">
        <h2>Authentication Endpoints</h2>

        <div class="endpoint">
            <span class="method">POST</span> <code>/api/register/</code>
            <p>Register a new student.</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{
  "email": "student@example.com",
  "first_name": "John",
  "last_name": "Doe",
  "middle_name": "A",
  "city": "Lagos",
  "state": "Lagos",
  "country_name": "Nigeria",
  "primary_phone": "08012345678",
  "password": "yourpassword"
}</pre>
            </div>
            <div class="response">
                <strong>Response:</strong>
                <pre>{
  "id": 1,
  "email": "student@example.com",
  ...
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method">POST</span> <code>/api/login/</code>
            <p>Authenticate and receive JWT tokens.</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{
  "email": "student@example.com",
  "password": "yourpassword"
}</pre>
            </div>
            <div class="response">
                <strong>Response:</strong>
                <pre>{
  "status": "success",
  "student": { ...student fields... }
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method">POST</span> <code>/api/logout/</code>
            <p>Logout and blacklist the refresh token.</p>
            <div class="response">
                <strong>Response:</strong>
                <pre>{ "message": "Logged out successfully" }</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method">POST</span> <code>/api/change-password/</code>
            <p>Change password (authenticated).</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{
  "old_password": "oldpass",
  "new_password": "newpass"
}</pre>
            </div>
            <div class="response">
                <strong>Response:</strong>
                <pre>{ "message": "Password updated successfully" }</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method">POST</span> <code>/api/forgot-password/</code>
            <p>Send password reset email.</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{ "email": "student@example.com" }</pre>
            </div>
            <div class="response">
                <strong>Response:</strong>
                <pre>{ "message": "Password reset email sent" }</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method">POST</span> <code>/api/reset-password/</code>
            <p>Reset password using token.</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{
  "new_password": "newpass",
  "token": "reset-token"
}</pre>
            </div>
            <div class="response">
                <strong>Response:</strong>
                <pre>{ "message": "Password reset successful" }</pre>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Student Endpoints</h2>
        <div class="endpoint">
            <span class="method">GET</span> <code>/api/student/</code>
            <p>List all students.</p>
        </div>
        <div class="endpoint">
            <span class="method">GET</span> <code>/api/student/{id}/</code>
            <p>Retrieve a student by ID.</p>
        </div>
        <div class="endpoint">
            <span class="method">PUT</span> <code>/api/student/{id}/</code>
            <p>Update a student.</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{
  "first_name": "Jane",
  "last_name": "Doe",
  ...
}</pre>
            </div>
        </div>
        <div class="endpoint">
            <span class="method">DELETE</span> <code>/api/student/{id}/</code>
            <p>Delete a student.</p>
        </div>
    </div>

    <div class="section">
        <h2>Course Endpoints</h2>
        <div class="endpoint">
            <span class="method">GET</span> <code>/api/course/</code>
            <p>List all courses.</p>
        </div>
        <div class="endpoint">
            <span class="method">POST</span> <code>/api/course/</code>
            <p>Create a new course.</p>
            <div class="payload">
                <strong>Payload:</strong>
                <pre>{
  "course_name": "Python",
  "course_image": "file.jpg",
  "course_duration": "3 months",
  "course_fees": "50000",
  "course_description": "Learn Python",
  "number_of_months": 3
}</pre>
            </div>
        </div>
        <div class="endpoint">
            <span class="method">GET</span> <code>/api/course/{id}/</code>
            <p>Retrieve a course by ID.</p>
        </div>
        <div class="endpoint">
            <span class="method">PUT</span> <code>/api/course/{id}/</code>
            <p>Update a course.</p>
        </div>
        <div class="endpoint">
            <span class="method">DELETE</span> <code>/api/course/{id}/</code>
            <p>Delete a course.</p>
        </div>
    </div>

    <div class="section">
        <h2>Profile Image Endpoints</h2>
        <div class="endpoint">
            <span class="method">POST</span> <code>/api/profile-image/</code>
            <p>Upload a profile image for a student.</p>
            <div class="payload">
                <strong>Payload (multipart/form-data):</strong>
                <ul>
                    <li><code>student</code>: Student ID</li>
                    <li><code>image</code>: Image file</li>
                </ul>
            </div>
            <div class="response">
                <strong>Response:</strong>
                <pre>{
  "status": "success",
  "data": {
    "id": 1,
    "student": 1,
    "image_url": "https://res.cloudinary.com/your_cloud/image/upload/v1234567890/profile_images/abc123.jpg"
  }
}</pre>
            </div>
        </div>
        <div class="endpoint">
            <span class="method">PUT</span> <code>/api/profile-image/{id}/</code>
            <p>Update profile image.</p>
        </div>
        <div class="endpoint">
            <span class="method">DELETE</span> <code>/api/profile-image/{id}/</code>
            <p>Delete profile image (removes from Cloudinary).</p>
        </div>
    </div>

    <div class="section">
        <h2>Security & Error Handling</h2>
        <ul>
            <li>All protected endpoints require JWT authentication via <code>Authorization: Bearer &lt;token&gt;</code> header.</li>
            <li>Passwords are securely hashed.</li>
            <li>Profile images are stored and managed via Cloudinary.</li>
            <li>Common errors: missing fields, authentication failure, image upload failure, integrity errors.</li>
        </ul>
    </div>

    <div class="section">
        <h2>Setup & Usage</h2>
        <ol>
            <li>Clone the repository and install dependencies.</li>
            <li>Configure database and Cloudinary credentials in <code>settings.py</code>.</li>
            <li>Run migrations and create a superuser.</li>
            <li>Start the server: <code>python manage.py runserver</code></li>
            <li>Access API at <code>http://127.0.0.1:8000/api/</code></li>
        </ol>
    </div>

    <div class="section">
        <h2>Testing & Troubleshooting</h2>
        <ul>
            <li>Run tests: <code>python manage.py test</code></li>
            <li>Image not displaying? Check Cloudinary credentials and upload status.</li>
            <li>IntegrityError on profile image? Only one image per student; update instead of creating new.</li>
            <li>JWT issues? Check token expiration and settings.</li>
        </ul>
    </div>

    <div class="section">
        <h2>Contributing</h2>
        <ol>
            <li>Fork the repository.</li>
            <li>Create a feature branch.</li>
            <li>Commit and push your changes.</li>
            <li>Open a pull request.</li>
        </ol>
    </div>
</body>
</html>